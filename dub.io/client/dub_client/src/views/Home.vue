<template>
  <v-container
    fluid
    style="height: 100vh; max-height: 100%;"
  >
    <v-row
      class="mr-2"
      align="center"
      justify="center"
      style="height: 100%; max-height: 100%;"
    >
      <v-col cols="2" style="height: 100%; width: 100%">
        <v-card
          width="100%"
          height="100%"
          outlined
          style="border: 1px solid black"
        >
          <v-card-title>
            Leaderboard:
          </v-card-title>

          <v-divider style="border: 0.5px solid black"></v-divider>

          <v-list
            disabled
            flat
            avatar
            two-line
          >
            <template v-for="(item, i) in $store.state.leaderBoard">
              <v-list-item
                :key="i"
                inactive
              >
                <v-list-item-avatar>
                  <v-img
                    contain
                    :src="item.sprite"
                    :style="`background-color: ${item.color}`"
                  ></v-img>
                </v-list-item-avatar>
                <v-list-item-content>
                  <v-list-item-title v-html="item.title"></v-list-item-title>
                  <v-list-item-subtitle v-html="item.points"></v-list-item-subtitle>
                </v-list-item-content>
              </v-list-item>
              <v-divider :key="`divider-${i}`" inset></v-divider>
            </template>
          </v-list>
        </v-card>
      </v-col>

      <v-col
        cols="8"
        style="height: 100%; max-height: 100%;"
      >
        <GameBoard />
      </v-col>

      <v-col cols="2" class="pr-2">
        <v-row>
          <v-col>
            <v-row>
              <v-col align="center" justify="center">
                <v-text-field
                  label="Username"
                  placeholder="RandomPlayer"
                  v-model="username"
                  :disabled="isUserActive"
                ></v-text-field>
              </v-col>
            </v-row>

            <v-row>
              <v-col align="center" justify="center">
                <v-color-picker
                  v-model="color"
                  mode="rgba"
                  hide-canvas
                  flat
                  :disabled="isUserActive"
                ></v-color-picker>
              </v-col>
            </v-row>

            <v-row>
              <v-col align="center" justify="center">
                <v-img contain height="10vh" width="10vh" :src="sprite"></v-img>
                <v-text-field
                  label="Sprite-URI"
                  v-model="sprite"
                  :disabled="isUserActive"
                >
                  <template v-slot:append-outer>
                    <v-btn
                      dark
                      small
                      @click="resetSprite"
                      :disabled="isUserActive"
                    >
                      <v-icon dark>mdi-undo-variant</v-icon>
                    </v-btn>
                  </template>
                </v-text-field>
              </v-col>
            </v-row>
          </v-col>
        </v-row>

        <v-row>
          <v-col cols="3" />
          <v-col cols="6" align="center" justify="center">
            <v-row align="center" justify="center">
              <v-btn
                dark
                large
                color="teal"
                @click="createUser"
                :disabled="isUserActive"
              >
                Add Player
              </v-btn>
            </v-row>
            <v-row align="center" justify="center">
              <v-switch
                :color="musicSwitch ? 'teal' : 'red'"
                v-model="musicSwitch"
                label="Music"
              ></v-switch>
            </v-row>
          </v-col>
          <v-col cols="3" />
        </v-row>

        <v-row align="center" justify="center">
          <v-col cols="4" align="center" justify="center">
            <v-btn
              :dark="isUserActive"
              @click="$store.dispatch('changeDirection', DIRECTIONS.UPLEFT);"
              :disabled="!isUserActive"
            >
              <v-icon dark>mdi-arrow-top-left-bold-outline</v-icon>
            </v-btn>
          </v-col>

          <v-col cols="4" align="center" justify="center">
            <v-btn
              :dark="isUserActive"
              @click="$store.dispatch('changeDirection', DIRECTIONS.UP);"
              :disabled="!isUserActive"
            >
              <v-icon dark>mdi-arrow-up-bold-outline</v-icon>
            </v-btn>
          </v-col>

          <v-col cols="4" align="center" justify="center">
            <v-btn
              :dark="isUserActive"
              @click="$store.dispatch('changeDirection', DIRECTIONS.UPRIGHT);"
              :disabled="!isUserActive"
            >
              <v-icon dark>mdi-arrow-top-right-bold-outline</v-icon>
            </v-btn>
          </v-col>
        </v-row>

        <v-row align="center" justify="center">
          <v-col cols="4" align="center" justify="center">
            <v-btn
              :dark="isUserActive"
              @click="$store.dispatch('changeDirection', DIRECTIONS.LEFT);"
              :disabled="!isUserActive"
            >
              <v-icon dark>mdi-arrow-left-bold-outline</v-icon>
            </v-btn>
          </v-col>

          <v-col cols="4" align="center" justify="center">
            <v-icon>mdi-arrow-all</v-icon>
            <p>Arrow-Keys</p>
          </v-col>

          <v-col cols="4" align="center" justify="center">
            <v-btn
              :dark="isUserActive"
              @click="$store.dispatch('changeDirection', DIRECTIONS.RIGHT);"
              :disabled="!isUserActive"
            >
              <v-icon dark>mdi-arrow-right-bold-outline</v-icon>
            </v-btn>
          </v-col>
        </v-row>

        <v-row align="center" justify="center">
          <v-col cols="4" align="center" justify="center">
            <v-btn
              :dark="isUserActive"
              @click="$store.dispatch('changeDirection', DIRECTIONS.DOWNLEFT);"
              :disabled="!isUserActive"
            >
              <v-icon dark>mdi-arrow-bottom-left-bold-outline</v-icon>
            </v-btn>
          </v-col>

          <v-col cols="4" align="center" justify="center">
            <v-btn
              :dark="isUserActive"
              @click="$store.dispatch('changeDirection', DIRECTIONS.DOWN);"
              :disabled="!isUserActive"
            >
              <v-icon dark>mdi-arrow-down-bold-outline</v-icon>
            </v-btn>
          </v-col>

          <v-col cols="4" align="center" justify="center">
            <v-btn
              :dark="isUserActive"
              @click="$store.dispatch('changeDirection', DIRECTIONS.DOWNRIGHT);"
              :disabled="!isUserActive"
            >
              <v-icon dark>mdi-arrow-bottom-right-bold-outline</v-icon>
            </v-btn>
          </v-col>
        </v-row>
      </v-col>
    </v-row>
  </v-container>
</template>

<script>
// @ is an alias to /src
import GameBoard from '@/components/GameBoard.vue';
import DIRECTIONS from '@/utils/enums/Directions';
import gameOptions from '../../../../gameOptions';

export default {
  name: 'Home',
  components: {
    GameBoard,
  },

  data() {
    return {
      sprite: gameOptions.DEFAULT_PLAYER_SPRITE,
      username: '',
      color: '#FF0000FF',
      musicSwitch: false,
      DIRECTIONS,
      isUserActive: false,
    };
  },

  methods: {
    resetSprite() {
      this.sprite = gameOptions.DEFAULT_PLAYER_SPRITE;
    },
    createUser() {
      const u = this.username || 'RandomPlayer';
      const s = this.sprite || gameOptions.DEFAULT_PLAYER_SPRITE;
      const c = this.color;

      this.$store.dispatch('createUser', { title: u, sprite: s, color: c });
    },
  },

  watch: {
    musicSwitch(newValue) {
      this.$store.dispatch('switchMusic', newValue);
    },
  },

  created() {
    this.$store.watch(
      (state, getters) => getters.userId,
      (newValue) => {
        this.isUserActive = !!newValue;
      },
    );
  },

  mounted() {
    this.$store.dispatch('subscribe');
  },
};
</script>

<style lang="scss">
.no-alpha {
  .v-color-picker__controls {
    .v-color-picker__preview {
      .v-color-picker__sliders {
        .v-color-picker__alpha {
          display: none;
        }
      }
    }
    .v-color-picker__edit {
      .v-color-picker__input:last-child {
        display: none;
      }
    }
  }
}
</style>
